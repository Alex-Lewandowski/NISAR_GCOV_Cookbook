#!/usr/bin/env bash
set -euxo pipefail

cd "${REPO_DIR:-/home/jovyan}"

# Fast path: use locked envs if present
if [ -f pixi.lock ]; then
  pixi install --locked || pixi install
else
  pixi install
fi

# List the envs you want available as kernels
ENVS=("default" "isce3")

for E in "${ENVS[@]}"; do
  if pixi info -e "$E" >/dev/null 2>&1; then
    # Install a kernel from each Pixi env
    pixi run -e "$E" -- python -m ipykernel install --user \
      --name "pixi-${E}" --display-name "Pixi (${E})"
  fi
done

jupyter kernelspec list
